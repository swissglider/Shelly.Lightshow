(this["webpackJsonpshelly.lightshow"]=this["webpackJsonpshelly.lightshow"]||[]).push([[0],{82:function(e,t,n){},83:function(e,t,n){},93:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(27),l=n.n(i),c=(n(82),n(7)),o=n(111),s=n(109),u=n(72),h=n(107),d=n(115),g=n(110),j=n(108),b=(n(83),n(11)),m=n.n(b),f=n(15),O=n(31),v=n(20),p=n(17),x=n(99),y=n(50),w=n(71),S=n(70),k=n(36),L=["shelly1","shelly2.5","shelly1PM"],T=["volumeChangedLight","avarageLight","maxLight","avarageLong"],C=new(function(e){Object(w.a)(n,e);var t=Object(S.a)(n);function n(){var e;return Object(y.a)(this,n),(e=t.call(this,"myDatabase")).lights=void 0,e.version(1).stores({lights:"++id, name, lightType, shellyType, ip"}),e}return n}(k.default)),z=n(3),E={volumeChangedLight:{timeout:0,waitTime:300,threshold:0},avarageLight:{timeout:100,waitTime:300,threshold:1.2},maxLight:{timeout:1e3,waitTime:300,threshold:1.8},avarageLong:{timeout:5e3,waitTime:300,threshold:1.6},lights:[{name:"light1",lightType:"volumeChangedLight"},{name:"light2",lightType:"avarageLight"},{name:"light3",lightType:"maxLight"},{name:"light4",lightType:"avarageLong"}]},R={},A=T.reduce((function(e,t){return Object(p.a)(Object(p.a)({},e),{},Object(v.a)({},t,!1))}),{}),F=T.reduce((function(e,t){return Object(p.a)(Object(p.a)({},e),{},Object(v.a)({},t,Date.now()))}),{}),D=T.reduce((function(e,t){return Object(p.a)(Object(p.a)({},e),{},Object(v.a)({},t,null))}),{}),U=[],M=[],P=function(e){var t=e.analyser,n=e.running,i=Object(a.useRef)(),l=Object(a.useState)(null),o=Object(c.a)(l,2),s=o[0],h=o[1],g=Object(a.useState)(0),j=Object(c.a)(g,2),b=j[0],m=j[1],f=Object(a.useRef)(),v=Object(a.useState)(null),p=Object(c.a)(v,2),y=p[0],w=p[1],S=Object(a.useState)(0),k=Object(c.a)(S,2),L=k[0],T=k[1],C=r.a.useState(),P=Object(c.a)(C,2)[1],W=r.a.useCallback((function(){return P({})}),[]);Object(a.useEffect)((function(){h(i.current.getContext("2d")),w(f.current.getContext("2d")),console.log("useEffect");var e,t=Object(O.a)(E.lights);try{for(t.s();!(e=t.n()).done;){var n=e.value;R[n.name]=!1}}catch(a){t.e(a)}finally{t.f()}}),[]);var B=function(e,t){var n=Date.now();if(n-F[e]>=E[e].waitTime&&A[e]!==t){clearTimeout(D[e]),F[e]=n,A[e]=t;var a,r=Object(O.a)(E.lights);try{for(r.s();!(a=r.n()).done;){var i=a.value;i.lightType===e&&(R[i.name]=t)}}catch(l){r.e(l)}finally{r.f()}0!==E[e].timeout&&(D[e]=setTimeout((function(){A[e]=!1;var t,n=Object(O.a)(E.lights);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.lightType===e&&(R[a.name]=!1)}}catch(l){n.e(l)}finally{n.f()}}),E[e].timeout))}};Object(a.useEffect)((function(){if(n&&t){Object.keys(R).forEach((function(e){R[e]=!1}));var e=t.frequencyBinCount,a=new Uint8Array(e);!function(e,a){var r=i.current.width,l=i.current.height;n&&t&&(console.log(e),s.clearRect(0,0,r,l),function i(){if(n&&t){var c=requestAnimationFrame(i);m(c),t.getByteFrequencyData(a),s.fillStyle="rgb(51, 51, 51)",s.fillRect(0,0,r,l);for(var o,u=r/(e+.7),h=0,d=0;d<e;d++)o=a[d],s.fillStyle="rgb("+(o+100)+",50,50)",s.fillRect(h,l-o/2,u,o/2),h+=u+1}}())}(e,a),function(e,a){var r=f.current.width,i=f.current.height;if(n&&t){y.clearRect(0,0,r,i);var l=!0;!function c(){if(n&&t){t.getByteFrequencyData(a);var o=requestAnimationFrame(c);T(o),y.fillStyle="rgb(51, 51, 51)",y.fillRect(0,0,r,i);var s=r/10,u=U.reduce((function(e,t){return e+t}),0)/U.length,h=U.slice(U.length<-64?-1:-6),d=h.reduce((function(e,t){return e+t}),0)/h.length;y.fillStyle="rgb("+(u+100)+",200,200)",y.fillRect(1*((r+6)/5-s/2),i-u/2,s,u/2),u<d&&B("volumeChangedLight",!0),u>d&&B("volumeChangedLight",!1);var g=U.slice(U.length<-30?-1:-30),j=g.reduce((function(e,t){return e+t}),0)/g.length,b=a.reduce((function(e,t){return e+t}),0)/e*3;y.fillStyle="rgb("+(b+100)+",200,200)",y.fillRect(2*((r+6)/5-s/2),i-b/2,s,b/2),b>j*E.avarageLight.threshold&&B("avarageLight",!0),U.push(b);var m=a.reduce((function(e,t){return e<t?t:e}),0);y.fillStyle="rgb("+(m+100)+",200,200)",y.fillRect(3*((r+6)/5-s/2),i-m/2,s,m/2),m>j*E.maxLight.threshold&&B("maxLight",!0);var f=M.slice(M.length<-100?-1:-100),O=f.reduce((function(e,t){return e+t}),0)/f.length,v=a.filter((function(e){return 0!==e})).length,p=a.reduce((function(e,t){return e+t}),0)/v;y.fillStyle="rgb("+(p+100)+",200,200)",y.fillRect(4*((r+6)/5-s/2),i-p/2,s,p/2),p>O*E.avarageLong.threshold&&B("avarageLong",!0),M.push(p),l&&console.log(a),l=!1}}()}}(e,a)}else!function(){if(s){window.cancelAnimationFrame(b);var e=i.current.width,t=i.current.height;s.clearRect(0,0,e,t)}if(y){window.cancelAnimationFrame(L);var n=f.current.width,a=f.current.height;y.clearRect(0,0,n,a)}}()}),[n]);return Object(z.jsxs)(u.a,{alignSelf:"center",pad:"small",justify:"center",gap:"medium",children:[Object(z.jsxs)(u.a,{direction:"row",gap:"small",justify:"center",children:[Object(z.jsxs)(u.a,{pad:"xsmall",alignSelf:"center",border:{color:"dark-2",size:"medium"},round:"medium",elevation:"small",children:[Object(z.jsx)(u.a,{alignSelf:"center",children:"Bar"}),Object(z.jsx)("canvas",{width:"300",height:"100",ref:i}),Object(z.jsx)(u.a,{direction:"row",justify:"around",margin:"small",children:Object(z.jsx)(u.a,{children:Object(z.jsx)(x.a,{color:"brand",size:"small",opacity:"0"})})})]}),Object(z.jsxs)(u.a,{pad:"xsmall",alignSelf:"center",border:{color:"dark-2",size:"medium"},round:"medium",elevation:"small",children:[Object(z.jsx)(u.a,{alignSelf:"center",children:"Total"}),Object(z.jsx)("canvas",{width:"50",height:"100",ref:f}),Object(z.jsx)(u.a,{direction:"row",justify:"around",margin:"small",children:Object.entries(A).map((function(e){var t=Object(c.a)(e,2),n=t[0],a=t[1];return Object(z.jsx)(u.a,{children:Object(z.jsx)(x.a,{color:a?"status-warning":"status-disabled",size:"small"})},"lightTypeStatus_"+n)}))})]})]}),Object(z.jsx)(u.a,{pad:"xsmall",alignSelf:"center",children:Object(z.jsx)(u.a,{direction:"row",justify:"around",margin:"small",children:Object.entries(E.lights).map((function(e){var t=Object(c.a)(e,2),a=t[0],r=t[1];return Object(z.jsxs)(u.a,{pad:"small",margin:"small",align:"center",gap:"small",children:[Object(z.jsx)(d.a,{level:"5",margin:"none",children:r.name}),Object(z.jsx)(x.a,{color:R[r.name]?"status-warning":"status-disabled",size:"large",onClick:function(){return e=r.name,t=R[r.name],void(n?console.log("only if animation is off"):(R[e]=!t,console.log(R,e,!t),W()));var e,t}})]},"lights-".concat(a))}))})})]})},W=function(){var e=Object(a.useState)(null),t=Object(c.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(null),l=Object(c.a)(i,2),o=l[0],s=l[1],h=Object(a.useState)(null),d=Object(c.a)(h,2),j=d[0],b=d[1],O=Object(a.useState)(!1),v=Object(c.a)(O,2),p=v[0],x=v[1],y=Object(a.useState)(null),w=Object(c.a)(y,2),S=w[0],k=w[1];Object(a.useEffect)((function(){void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise((function(n,a){t.call(navigator,e,n,a)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))});var e=new window.AudioContext||window.webkitAudioContext;r(e)}),[]);var L=function(){var e=Object(f.a)(m.a.mark((function e(){var t,a,r,i,l,c,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,(t=n.createAnalyser()).minDecibels=-90,t.maxDecibels=-10,t.smoothingTimeConstant=.85,t.fftSize=64,b(t),a=n.createWaveShaper(),r=n.createGain(),i=n.createBiquadFilter(),l=n.createConvolver(),e.next=15,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 15:window.stream=c=e.sent,o=n.createMediaStreamSource(c),k(c),o.connect(a),a.connect(i),i.connect(r),l.connect(r),r.connect(t),s(o),i.gain.setTargetAtTime(0,n.currentTime,0),i.disconnect(0),i.connect(r),i.type="lowshelf",i.frequency.setTargetAtTime(1e3,n.currentTime,0),x(!0),e.next=35;break;case 32:e.prev=32,e.t0=e.catch(2),console.log("Error: Issue getting mic",e.t0);case 35:case"end":return e.stop()}}),e,null,[[2,32]])})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(u.a,{direction:"row",justify:"center",gap:"medium",margin:"small",children:p?Object(z.jsx)(g.a,{onClick:function(){x(!1),j&&(j.disconnect(0),b(null)),o&&(o.disconnect(0),s(null)),S&&(S.getAudioTracks().forEach((function(e){e.stop()})),k(null))},label:"Stop"}):Object(z.jsx)(g.a,{onClick:T,label:"Start"})}),Object(z.jsx)(P,{running:p,analyser:j})]})},B=n(114),q=n(112),I=n(103),G=n(104),N=function(e){var t=e.method,n=e.toEditLight,r=e.onClose,i=Object(a.useState)(""),l=Object(c.a)(i,2),o=l[0],s=l[1],h=Object(a.useState)(""),j=Object(c.a)(h,2),b=j[0],O=j[1],v=Object(a.useState)(null),p=Object(c.a)(v,2),x=p[0],y=p[1],w=Object(a.useState)(null),S=Object(c.a)(w,2),k=S[0],E=S[1],R=Object(a.useState)("Add new Light"),A=Object(c.a)(R,2),F=A[0],D=A[1];Object(a.useEffect)((function(){"edit"===t&&n&&(s(n.name),O(n.ip),y(n.shellyType),E(n.lightType),D("Edit Light"))}),[]);var U=function(){var e=Object(f.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("hallo0"),""===o||""===b||null===x||null===k){e.next=24;break}if("new"!==t){e.next=21;break}return console.log("hallo1"),e.prev=4,console.log("hallo2"),e.next=8,C.lights.add({name:o,lightType:k,shellyType:x,ip:b});case 8:n=e.sent,console.log("ID = "+n),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),console.log("Failed to add ".concat(name,": ").concat(e.t0));case 15:s(""),O(""),y(null),E(null),e.next=22;break;case 21:r();case 22:e.next=25;break;case 24:alert("Everything is mandatory");case 25:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(){return e.apply(this,arguments)}}();return Object(z.jsxs)(u.a,{border:{color:"dark-3",size:"small"},round:"xsmall",children:[Object(z.jsx)(d.a,{level:"3",margin:"xsmall",alignSelf:"center",children:F}),Object(z.jsx)(u.a,{border:[{color:"dark-3",size:"small",side:"bottom"}]}),Object(z.jsxs)(u.a,{margin:"medium",direction:"row",gap:"small",align:"center",wrap:!0,children:[Object(z.jsx)(u.a,{children:Object(z.jsx)(B.a,{size:"small",placeholder:"Light Name...",value:o,plain:!0,onChange:function(e){return s(e.target.value)}})}),Object(z.jsx)(u.a,{children:Object(z.jsx)(B.a,{size:"small",placeholder:"Light IP...",value:b,plain:!0,onChange:function(e){return O(e.target.value)}})}),Object(z.jsx)(q.a,{size:"small",placeholder:"select Shelly Type...",value:null!==x&&void 0!==x?x:"",options:L,onChange:function(e){var t=e.option;return y(t)}}),Object(z.jsx)(q.a,{size:"small",placeholder:"select Light Type...",value:null!==k&&void 0!==k?k:"",options:T,onChange:function(e){var t=e.option;return E(t)}}),Object(z.jsx)(u.a,{round:"full",overflow:"hidden",background:"status-ok",alignSelf:"center",children:Object(z.jsx)(g.a,{icon:"new"===t?Object(z.jsx)(I.a,{size:"small"}):Object(z.jsx)(G.a,{size:"small",onClick:function(){return U()}}),hoverIndicator:!0})})]})]})},J=n(105),_=n(106),Q=function(e){var t=e.light,n=e.onEditLight,a=e.onRemoveLight;return Object(z.jsxs)(u.a,{margin:"medium",direction:"row",gap:"small",justify:"around",align:"center",children:[Object(z.jsx)(u.a,{children:Object(z.jsx)(B.a,{size:"small",value:t.name,plain:!0})}),Object(z.jsx)(u.a,{children:Object(z.jsx)(B.a,{size:"small",value:t.ip,plain:!0})}),Object(z.jsxs)(u.a,{direction:"row",gap:"small",margin:{right:"small"},children:[Object(z.jsx)(J.a,{color:"status-warning",size:"medium",onClick:function(){return n(t)}}),Object(z.jsx)(_.a,{color:"status-error",size:"medium",onClick:function(){return a(t)}})]})]})},V=function(e){var t=e.lights,n=e.onEditLight,a=e.onRemoveLight;return Object(z.jsxs)(u.a,{border:{color:"dark-3",size:"small"},round:"xsmall",children:[Object(z.jsx)(d.a,{level:"3",margin:"xsmall",alignSelf:"center",children:"Existing Lights"}),Object(z.jsx)(u.a,{border:[{color:"dark-3",size:"small",side:"bottom"}]}),t.map((function(e){return Object(z.jsx)(Q,{light:e,onEditLight:n,onRemoveLight:a},"hallo_".concat(e.name))}))]})},$=n(69),H=[{name:"Lights1",ip:"192.168.90.1",lightType:"volumeChangedLight",shellyType:"shelly1"},{name:"Lights2",ip:"192.168.90.2",lightType:"volumeChangedLight",shellyType:"shelly1"},{name:"Lights3",ip:"192.168.90.3",lightType:"volumeChangedLight",shellyType:"shelly1"},{name:"Lights3",ip:"192.168.90.4",lightType:"volumeChangedLight",shellyType:"shelly1"}],K=function(e){var t=e.setClose,n=Object(a.useState)(!1),r=Object(c.a)(n,2),i=r[0],l=r[1],o=Object(a.useState)(null),s=Object(c.a)(o,2),b=s[0],O=s[1],v=Object(a.useState)([]),p=Object(c.a)(v,2),x=p[0],y=p[1],w=Object($.useLiveQuery)((function(){return C.lights.toArray()}));console.log(w),Object(a.useEffect)((function(){y(H)}),[]);var S=function(){l(!1)};return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsxs)(u.a,{justify:"center",alignSelf:"center",margin:"small",border:{color:"dark-3",size:"small"},round:"medium",background:"dark-1",children:[Object(z.jsxs)(h.a,{justify:"between",margin:{horizontal:"small"},height:"xxsmall",round:{corner:"top",size:"medium"},children:[Object(z.jsx)(d.a,{level:"2",margin:"none",children:"Config"}),Object(z.jsx)(u.a,{children:Object(z.jsx)(g.a,{size:"small",label:"Close",onClick:function(){return t()}})})]}),Object(z.jsx)(u.a,{border:[{color:"dark-3",size:"small",side:"bottom"}]}),Object(z.jsxs)(j.a,{alignSelf:"center",children:[!i&&Object(z.jsxs)(u.a,{pad:"small",justify:"center",gap:"large",children:[Object(z.jsx)(N,{method:"new",onClose:S}),Object(z.jsx)(V,{lights:x,onEditLight:function(e){l(!0),O(e)},onRemoveLight:function(e){}})]}),i&&b&&Object(z.jsx)(u.a,{pad:"small",justify:"center",gap:"large",children:Object(z.jsx)(N,{method:"edit",toEditLight:b,onClose:S})})]})]}),Object(z.jsx)("button",{className:"large-button",onClick:function(){C.transaction("rw",C.tables,Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(C.tables.map((function(e){return e.clear()})));case 2:case"end":return e.stop()}}),e)}))))},children:"Clear Database"})]})},X=function(){var e=Object(a.useState)(!1),t=Object(c.a)(e,2),n=t[0],r=t[1];return Object(z.jsx)(z.Fragment,{children:Object(z.jsxs)(o.a,{theme:s.a,background:"dark-1",children:[!n&&Object(z.jsxs)(u.a,{justify:"center",alignSelf:"center",margin:"small",border:{color:"dark-3",size:"small"},round:"medium",background:"dark-1",children:[Object(z.jsxs)(h.a,{height:"xxsmall",round:{corner:"top",size:"large"},justify:"between",margin:{horizontal:"small"},children:[Object(z.jsx)(d.a,{level:"3",margin:"none",children:"Lightshow with Shellys V0.0.11"}),Object(z.jsx)(u.a,{children:Object(z.jsx)(g.a,{size:"small",label:"Settings",onClick:function(){return r(!0)}})})]}),Object(z.jsx)(u.a,{border:[{color:"dark-3",size:"small",side:"bottom"}]}),Object(z.jsx)(j.a,{alignSelf:"center",pad:"small",justify:"center",children:Object(z.jsx)(W,{})})]}),n&&Object(z.jsx)(K,{setClose:function(){r(!1)}})]})})},Y=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Z(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var ee=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,120)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,l=t.getTTFB;n(e),a(e),r(e),i(e),l(e)}))};l.a.render(Object(z.jsx)(r.a.StrictMode,{children:Object(z.jsx)(X,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/Shelly.Lightshow",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/Shelly.Lightshow","/service-worker.js");Y?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Z(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):Z(t,e)}))}}(),ee()}},[[93,1,2]]]);
//# sourceMappingURL=main.eb8b4dfd.chunk.js.map