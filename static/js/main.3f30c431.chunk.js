(this["webpackJsonpshelly.lightshow"]=this["webpackJsonpshelly.lightshow"]||[]).push([[0],{77:function(e,t,n){},78:function(e,t,n){},88:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(25),c=n.n(i),l=(n(77),n(9)),o=n(105),s=n(103),u=n(66),d=n(97),g=n(109),h=n(104),j=n(98),f=(n(78),n(22)),b=n.n(f),m=n(36),v=n(28),O=n(94),x=n(3),w={volumeChangedLight:{timeout:0,waitTime:300,threshold:0},avarageLight:{timeout:100,waitTime:300,threshold:1.2},maxLight:{timeout:1e3,waitTime:300,threshold:1.8},avarageLong:{timeout:5e3,waitTime:300,threshold:1.6},lights:[{name:"light1",type:"volumeChangedLight"},{name:"light2",type:"avarageLight"},{name:"light3",type:"maxLight"},{name:"light4",type:"avarageLong"}]},p={},y={volumeChangedLight:!1,avarageLight:!1,maxLight:!1,avarageLong:!1},S={volumeChangedLight:Date.now(),avarageLight:Date.now(),maxLight:Date.now(),avarageLong:Date.now()},k={volumeChangedLight:null,avarageLight:null,maxLight:null,avarageLong:null},L=[],C=[],T=function(e){var t=e.analyser,n=e.running,i=Object(a.useRef)(),c=Object(a.useState)(null),o=Object(l.a)(c,2),s=o[0],d=o[1],h=Object(a.useState)(0),j=Object(l.a)(h,2),f=j[0],b=j[1],m=Object(a.useRef)(),T=Object(a.useState)(null),z=Object(l.a)(T,2),A=z[0],F=z[1],R=Object(a.useState)(0),D=Object(l.a)(R,2),E=D[0],U=D[1],M=r.a.useState(),W=Object(l.a)(M,2)[1],B=r.a.useCallback((function(){return W({})}),[]);Object(a.useEffect)((function(){d(i.current.getContext("2d")),F(m.current.getContext("2d")),console.log("useEffect");var e,t=Object(v.a)(w.lights);try{for(t.s();!(e=t.n()).done;){var n=e.value;p[n.name]=!1}}catch(a){t.e(a)}finally{t.f()}}),[]);var P=function(e,t){var n=Date.now();if(n-S[e]>=w[e].waitTime&&y[e]!==t){clearTimeout(k[e]),S[e]=n,y[e]=t;var a,r=Object(v.a)(w.lights);try{for(r.s();!(a=r.n()).done;){var i=a.value;i.type===e&&(p[i.name]=t)}}catch(c){r.e(c)}finally{r.f()}0!==w[e].timeout&&(k[e]=setTimeout((function(){y[e]=!1;var t,n=Object(v.a)(w.lights);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.type===e&&(p[a.name]=!1)}}catch(c){n.e(c)}finally{n.f()}}),w[e].timeout))}};Object(a.useEffect)((function(){if(n&&t){Object.keys(p).forEach((function(e){p[e]=!1}));var e=t.frequencyBinCount,a=new Uint8Array(e);!function(e,a){var r=i.current.width,c=i.current.height;n&&t&&(console.log(e),s.clearRect(0,0,r,c),function i(){if(n&&t){var l=requestAnimationFrame(i);b(l),t.getByteFrequencyData(a),s.fillStyle="rgb(51, 51, 51)",s.fillRect(0,0,r,c);for(var o,u=r/(e+.7),d=0,g=0;g<e;g++)o=a[g],s.fillStyle="rgb("+(o+100)+",50,50)",s.fillRect(d,c-o/2,u,o/2),d+=u+1}}())}(e,a),function(e,a){var r=m.current.width,i=m.current.height;if(n&&t){A.clearRect(0,0,r,i);var c=!0;!function l(){if(n&&t){t.getByteFrequencyData(a);var o=requestAnimationFrame(l);U(o),A.fillStyle="rgb(51, 51, 51)",A.fillRect(0,0,r,i);var s=r/10,u=L.reduce((function(e,t){return e+t}),0)/L.length,d=L.slice(L.length<-64?-1:-6),g=d.reduce((function(e,t){return e+t}),0)/d.length;A.fillStyle="rgb("+(u+100)+",200,200)",A.fillRect(1*((r+6)/5-s/2),i-u/2,s,u/2),u<g&&P("volumeChangedLight",!0),u>g&&P("volumeChangedLight",!1);var h=L.slice(L.length<-30?-1:-30),j=h.reduce((function(e,t){return e+t}),0)/h.length,f=a.reduce((function(e,t){return e+t}),0)/e*3;A.fillStyle="rgb("+(f+100)+",200,200)",A.fillRect(2*((r+6)/5-s/2),i-f/2,s,f/2),f>j*w.avarageLight.threshold&&P("avarageLight",!0),L.push(f);var b=a.reduce((function(e,t){return e<t?t:e}),0);A.fillStyle="rgb("+(b+100)+",200,200)",A.fillRect(3*((r+6)/5-s/2),i-b/2,s,b/2),b>j*w.maxLight.threshold&&P("maxLight",!0);var m=C.slice(C.length<-100?-1:-100),v=m.reduce((function(e,t){return e+t}),0)/m.length,O=a.filter((function(e){return 0!==e})).length,x=a.reduce((function(e,t){return e+t}),0)/O;A.fillStyle="rgb("+(x+100)+",200,200)",A.fillRect(4*((r+6)/5-s/2),i-x/2,s,x/2),x>v*w.avarageLong.threshold&&P("avarageLong",!0),C.push(x),c&&console.log(a),c=!1}}()}}(e,a)}else!function(){if(s){window.cancelAnimationFrame(f);var e=i.current.width,t=i.current.height;s.clearRect(0,0,e,t)}if(A){window.cancelAnimationFrame(E);var n=m.current.width,a=m.current.height;A.clearRect(0,0,n,a)}}()}),[n]);return Object(x.jsxs)(u.a,{alignSelf:"center",pad:"small",justify:"center",gap:"medium",children:[Object(x.jsxs)(u.a,{direction:"row",gap:"small",justify:"center",children:[Object(x.jsxs)(u.a,{pad:"xsmall",alignSelf:"center",border:{color:"dark-2",size:"medium"},round:"medium",elevation:"small",children:[Object(x.jsx)(u.a,{alignSelf:"center",children:"Bar"}),Object(x.jsx)("canvas",{width:"300",height:"100",ref:i}),Object(x.jsx)(u.a,{direction:"row",justify:"around",margin:"small",children:Object(x.jsx)(u.a,{children:Object(x.jsx)(O.a,{color:"brand",size:"small",opacity:"0"})})})]}),Object(x.jsxs)(u.a,{pad:"xsmall",alignSelf:"center",border:{color:"dark-2",size:"medium"},round:"medium",elevation:"small",children:[Object(x.jsx)(u.a,{alignSelf:"center",children:"Total"}),Object(x.jsx)("canvas",{width:"50",height:"100",ref:m}),Object(x.jsx)(u.a,{direction:"row",justify:"around",margin:"small",children:Object.entries(y).map((function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return Object(x.jsx)(u.a,{children:Object(x.jsx)(O.a,{color:a?"status-warning":"status-disabled",size:"small"})},"lightTypeStatus_"+n)}))})]})]}),Object(x.jsx)(u.a,{pad:"xsmall",alignSelf:"center",children:Object(x.jsx)(u.a,{direction:"row",justify:"around",margin:"small",children:Object.entries(w.lights).map((function(e){var t=Object(l.a)(e,2),a=t[0],r=t[1];return Object(x.jsxs)(u.a,{pad:"small",margin:"small",align:"center",gap:"small",children:[Object(x.jsx)(g.a,{level:"5",margin:"none",children:r.name}),Object(x.jsx)(O.a,{color:p[r.name]?"status-warning":"status-disabled",size:"large",onClick:function(){return e=r.name,t=p[r.name],void(n?console.log("only if animation is off"):(p[e]=!t,console.log(p,e,!t),B()));var e,t}})]},"lights-".concat(a))}))})})]})},z=function(){var e=Object(a.useState)(null),t=Object(l.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(null),c=Object(l.a)(i,2),o=c[0],s=c[1],d=Object(a.useState)(null),g=Object(l.a)(d,2),j=g[0],f=g[1],v=Object(a.useState)(!1),O=Object(l.a)(v,2),w=O[0],p=O[1],y=Object(a.useState)(null),S=Object(l.a)(y,2),k=S[0],L=S[1];Object(a.useEffect)((function(){void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise((function(n,a){t.call(navigator,e,n,a)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))});var e=new window.AudioContext||window.webkitAudioContext;r(e)}),[]);var C=function(){var e=Object(m.a)(b.a.mark((function e(){var t,a,r,i,c,l,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,(t=n.createAnalyser()).minDecibels=-90,t.maxDecibels=-10,t.smoothingTimeConstant=.85,t.fftSize=64,f(t),a=n.createWaveShaper(),r=n.createGain(),i=n.createBiquadFilter(),c=n.createConvolver(),e.next=15,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 15:window.stream=l=e.sent,o=n.createMediaStreamSource(l),L(l),o.connect(a),a.connect(i),i.connect(r),c.connect(r),r.connect(t),s(o),i.gain.setTargetAtTime(0,n.currentTime,0),i.disconnect(0),i.connect(r),i.type="lowshelf",i.frequency.setTargetAtTime(1e3,n.currentTime,0),p(!0),e.next=35;break;case 32:e.prev=32,e.t0=e.catch(2),console.log("Error: Issue getting mic",e.t0);case 35:case"end":return e.stop()}}),e,null,[[2,32]])})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=Object(m.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(u.a,{direction:"row",justify:"center",gap:"medium",margin:"small",children:w?Object(x.jsx)(h.a,{onClick:function(){p(!1),j&&(j.disconnect(0),f(null)),o&&(o.disconnect(0),s(null)),k&&(k.getAudioTracks().forEach((function(e){e.stop()})),L(null))},label:"Stop"}):Object(x.jsx)(h.a,{onClick:z,label:"Start"})}),Object(x.jsx)(T,{running:w,analyser:j})]})},A=n(65),F=n(108),R=n(106),D=n(100),E=n(101),U=n(102),M=["shelly1","shelly2.5","shelly1PM"],W=["volumeChangedLight","avarageLight","maxLight","avarageLong"],B=function(e){e.name;var t=e.setClose;return Object(a.useEffect)((function(){}),[]),Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)(u.a,{justify:"center",alignSelf:"center",margin:"small",border:{color:"dark-3",size:"small"},round:"large",background:"dark-1",children:[Object(x.jsxs)(d.a,{justify:"center",height:"xxsmall",round:{corner:"top",size:"large"},children:[Object(x.jsx)(g.a,{level:"2",margin:"none",children:"Lightshow with Shellys - Config"}),Object(x.jsx)(u.a,{children:Object(x.jsx)(h.a,{label:"Close",onClick:function(){return t()}})})]}),Object(x.jsx)(u.a,{border:[{color:"dark-3",size:"small",side:"bottom"}]}),Object(x.jsxs)(j.a,{alignSelf:"center",pad:"small",justify:"center",gap:"large",children:[Object(x.jsxs)(u.a,{border:{color:"dark-3",size:"small"},round:"xsmall",children:[Object(x.jsx)(g.a,{level:"3",margin:"xsmall",alignSelf:"center",children:"Add new Light"}),Object(x.jsx)(u.a,{border:[{color:"dark-3",size:"small",side:"bottom"}]}),Object(x.jsxs)(u.a,{margin:"medium",direction:"row",gap:"small",align:"center",children:[Object(x.jsx)(u.a,{children:Object(x.jsx)(F.a,{placeholder:"Light Name...",plain:!0})}),Object(x.jsx)(u.a,{children:Object(x.jsx)(F.a,{placeholder:"Light IP...",plain:!0})}),Object(x.jsx)(R.a,{placeholder:"Select Shelly Type",options:M}),Object(x.jsx)(R.a,{placeholder:"Select Light Type",options:W}),Object(x.jsx)(u.a,{round:"full",overflow:"hidden",background:"status-ok",alignSelf:"center",children:Object(x.jsx)(h.a,{icon:Object(x.jsx)(D.a,{size:"small"}),hoverIndicator:!0})})]})]}),Object(x.jsxs)(u.a,{border:{color:"dark-3",size:"small"},round:"xsmall",children:[Object(x.jsx)(g.a,{level:"3",margin:"xsmall",alignSelf:"center",children:"Existing Lights"}),Object(x.jsx)(u.a,{border:[{color:"dark-3",size:"small",side:"bottom"}]}),Object(A.a)(Array(10).keys()).map((function(e){return Object(x.jsxs)(u.a,{margin:"medium",direction:"row",gap:"small",align:"center",children:[Object(x.jsx)(u.a,{children:Object(x.jsx)(F.a,{value:"Light1",plain:!0})}),Object(x.jsx)(u.a,{children:Object(x.jsx)(F.a,{value:"192.168.90.29",plain:!0})}),Object(x.jsx)(R.a,{value:"shelly1",options:M}),Object(x.jsx)(R.a,{value:"volumeChangedLight",options:W}),Object(x.jsx)(u.a,{round:"full",overflow:"hidden",background:"status-warning",alignSelf:"center",children:Object(x.jsx)(h.a,{icon:Object(x.jsx)(E.a,{size:"small"}),hoverIndicator:!0})}),Object(x.jsx)(u.a,{round:"full",overflow:"hidden",background:"status-critical",alignSelf:"center",children:Object(x.jsx)(h.a,{icon:Object(x.jsx)(U.a,{size:"small"}),hoverIndicator:!0})})]},"hallo_".concat(e))}))]})]})]})})},P=function(){var e=Object(a.useState)(!1),t=Object(l.a)(e,2),n=t[0],r=t[1];return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)(o.a,{theme:s.a,background:"dark-1",children:[!n&&Object(x.jsxs)(u.a,{justify:"center",alignSelf:"center",margin:"small",border:{color:"dark-3",size:"small"},round:"large",background:"dark-1",children:[Object(x.jsxs)(d.a,{justify:"center",height:"xxsmall",round:{corner:"top",size:"large"},children:[Object(x.jsx)(g.a,{level:"2",margin:"none",children:"Lightshow with Shellys V0.0.6"}),Object(x.jsx)(u.a,{children:Object(x.jsx)(h.a,{label:"Settings",onClick:function(){return r(!0)}})})]}),Object(x.jsx)(u.a,{border:[{color:"dark-3",size:"small",side:"bottom"}]}),Object(x.jsx)(j.a,{alignSelf:"center",pad:"small",justify:"center",children:Object(x.jsx)(z,{})})]}),n&&Object(x.jsx)(B,{name:"",setClose:function(){r(!1)}})]})})},q=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function I(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var G=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,114)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))};c.a.render(Object(x.jsx)(r.a.StrictMode,{children:Object(x.jsx)(P,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/Shelly.Lightshow",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/Shelly.Lightshow","/service-worker.js");q?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):I(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):I(t,e)}))}}(),G()}},[[88,1,2]]]);
//# sourceMappingURL=main.3f30c431.chunk.js.map