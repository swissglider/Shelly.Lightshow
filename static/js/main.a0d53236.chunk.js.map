{"version":3,"sources":["db/index.ts","controllers/VisualController/index.tsx","controllers/controller.tsx","configuration/NewEditLight.tsx","configuration/LightListElement.tsx","configuration/LightList.tsx","configuration/config.tsx","App.tsx","serviceWorkerRegistration.ts","reportWebVitals.ts","index.tsx"],"names":["L_ShellyTypes_List","L_LightTypes_List","db","lights","version","stores","Dexie","config","volumeChangedLight","timeout","waitTime","threshold","avarageLight","maxLight","avarageLong","name","lightType","lightStates","lightTypeStatus","reduce","a","v","lastUpdates","Date","now","timeouts","avarageLightTotalArray","avarageLongLightTotalArray","VisualController","analyser","running","canvasRefBar","useRef","useState","canvasCtxBar","setCanvasCtxBar","drawVisualBar","setDrawVisualBar","canvasRefTotal","canvasCtxTotal","setCanvasCtxTotal","drawVisualTotal","setDrawVisualTotal","React","updateState","forceUpdate","useCallback","useLiveQuery","toArray","useEffect","current","getContext","console","log","lightConf","switchLight","on","_now","clearTimeout","setTimeout","Object","keys","forEach","key","bufferLength","frequencyBinCount","dataArray","Uint8Array","WIDTH","width","HEIGHT","height","clearRect","draw","setDrawVisual_","requestAnimationFrame","getByteFrequencyData","fillStyle","fillRect","barHeight","barWidth","x","i","visualizeBar","firstTime","_totalAv","accumulator","curr","length","_last50totalAv","slice","_last50totalAv_av","_last500totalAv","_last500totalAv_av","_avX3","push","_max","_last50Without0Av","_last50Without0Av_av","_countAVWithout0","filter","e","_avWithout0","visiualizeTotal","window","cancelAnimationFrame","WIDTH1","HEIGHT1","stop","Box","alignSelf","pad","justify","gap","direction","border","color","size","round","elevation","ref","margin","RadialSelected","opacity","entries","map","value","align","Heading","level","onClick","lightName","lightCurrentState","Controller","audioCtx","setAudioCtx","audioInput","setAudioInput","setAnalyser","setRunning","stream","setStream","undefined","navigator","mediaDevices","getUserMedia","constraints","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","Promise","resolve","reject","call","Error","_audioCtx","AudioContext","webkitAudioContext","setupMic","analyser_","createAnalyser","minDecibels","maxDecibels","smoothingTimeConstant","fftSize","distortion","createWaveShaper","gainNode","createGain","biquadFilter","createBiquadFilter","convolver","createConvolver","audio","video","stream_","audioInput_","createMediaStreamSource","connect","gain","setTargetAtTime","currentTime","disconnect","type","frequency","start","Button","getAudioTracks","track","label","NewEditLight","method","toEditLight","onClose","setLightName","lightIP","setLightIP","shellyType","setShellyType","setlightType","title","setTitle","ip","saveAdd","add","id","put","alert","side","wrap","TextInput","placeholder","plain","onChange","event","target","Select","options","option","overflow","background","icon","Add","Save","hoverIndicator","LigthListElement","light","onEditLight","onRemoveLight","right","Edit","Trash","LightList","Configuration","setClose","isEdit","setIsEdit","selectedLight","setSelectedLight","Header","horizontal","corner","Main","delete","className","transaction","tables","all","table","clear","App","showConfig","setShowConfig","Grommet","theme","grommet","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","onSuccess","catch","error","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById","URL","process","href","origin","addEventListener","fetch","headers","response","contentType","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"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","file":"static/js/main.a0d53236.chunk.js","sourcesContent":["import Dexie, { Table } from 'dexie';\n\nexport const L_ShellyTypes_List = ['shelly1', 'shelly2.5', 'shelly1PM'];\nexport type T_ShellyTypes = typeof L_ShellyTypes_List[number];\n\nexport const L_LightTypes_List = ['volumeChangedLight', 'avarageLight', 'maxLight', 'avarageLong'];\nexport type T_LightTypes = typeof L_LightTypes_List[number];\n\nexport type T_Light = {\n\tid?: number;\n\tname: string;\n\tlightType: T_LightTypes;\n\tshellyType: T_ShellyTypes;\n\tip: string;\n};\n\nexport class MySubClassedDexie extends Dexie {\n\t// 'lights' is added by dexie when declaring the stores()\n\t// We just tell the typing system this is the case\n\tlights!: Table<T_Light>;\n\n\tconstructor() {\n\t\tsuper('myDatabase');\n\t\tthis.version(1).stores({\n\t\t\tlights: `++id, name, lightType, shellyType, ip`, // Primary key and indexed props\n\t\t});\n\t}\n}\n\nexport const db = new MySubClassedDexie();\n","import React, { FC, useEffect, useRef, useState } from 'react';\nimport { Box, Heading } from 'grommet';\nimport { RadialSelected } from 'grommet-icons';\nimport { db, L_LightTypes_List, T_LightTypes } from '../../db';\nimport { useLiveQuery } from 'dexie-react-hooks';\n\nexport interface I_VisualController_Props {\n\tanalyser: AnalyserNode | null;\n\trunning: boolean;\n}\n\nconst config: Record<string, any> = {\n\tvolumeChangedLight: {\n\t\ttimeout: 0, // timeout wait to switch off --> 0 no switch off\n\t\twaitTime: 300, // wait till next change in ms\n\t\tthreshold: 0, // threshold if 0 no threshold\n\t},\n\tavarageLight: {\n\t\ttimeout: 100,\n\t\twaitTime: 300,\n\t\tthreshold: 1.2,\n\t},\n\tmaxLight: {\n\t\ttimeout: 1000,\n\t\twaitTime: 300,\n\t\tthreshold: 1.8,\n\t},\n\tavarageLong: {\n\t\ttimeout: 5000,\n\t\twaitTime: 300,\n\t\tthreshold: 1.6,\n\t},\n\n\tlights: [\n\t\t{ name: 'light1', lightType: 'volumeChangedLight' },\n\t\t{ name: 'light2', lightType: 'avarageLight' },\n\t\t{ name: 'light3', lightType: 'maxLight' },\n\t\t{ name: 'light4', lightType: 'avarageLong' },\n\t],\n};\n\nconst lightStates: Record<T_LightTypes, boolean> = {};\nconst lightTypeStatus: Record<T_LightTypes, boolean> = L_LightTypes_List.reduce(\n\t(a, v) => ({ ...a, [v]: false }),\n\t{} as Record<T_LightTypes, boolean>,\n);\n\n// const lightTypeStatus: Record<T_LightTypes, boolean> = {\n// \tvolumeChangedLight: false,\n// \tavarageLight: false,\n// \tmaxLight: false,\n// \tavarageLong: false,\n// };\n\nconst lastUpdates: Record<T_LightTypes, number> = L_LightTypes_List.reduce(\n\t(a, v) => ({ ...a, [v]: Date.now() }),\n\t{} as Record<T_LightTypes, number>,\n);\n\n// const lastUpdates: Record<T_LightTypes, number> = {\n// \tvolumeChangedLight: Date.now(),\n// \tavarageLight: Date.now(),\n// \tmaxLight: Date.now(),\n// \tavarageLong: Date.now(),\n// };\n\nconst timeouts: Record<T_LightTypes, any> = L_LightTypes_List.reduce(\n\t(a, v) => ({ ...a, [v]: null }),\n\t{} as Record<T_LightTypes, any>,\n);\n\n// const timeouts: Record<T_LightTypes, any> = {\n// \tvolumeChangedLight: null,\n// \tavarageLight: null,\n// \tmaxLight: null,\n// \tavarageLong: null,\n// };\n\nconst avarageLightTotalArray: number[] = [];\nconst avarageLongLightTotalArray: number[] = [];\n\nconst VisualController: FC<I_VisualController_Props> = ({ analyser, running }: I_VisualController_Props) => {\n\tconst canvasRefBar = useRef<any>();\n\tconst [canvasCtxBar, setCanvasCtxBar] = useState<any>(null);\n\tconst [drawVisualBar, setDrawVisualBar] = useState<number>(0);\n\n\tconst canvasRefTotal = useRef<any>();\n\tconst [canvasCtxTotal, setCanvasCtxTotal] = useState<any>(null);\n\tconst [drawVisualTotal, setDrawVisualTotal] = useState<number>(0);\n\n\t// to force render\n\tconst [, updateState] = React.useState();\n\tconst forceUpdate = React.useCallback(() => updateState({} as any), []);\n\n\tconst lights = useLiveQuery(() => db.lights.toArray());\n\n\tuseEffect(() => {\n\t\tsetCanvasCtxBar(canvasRefBar.current.getContext('2d'));\n\t\tsetCanvasCtxTotal(canvasRefTotal.current.getContext('2d'));\n\t}, []);\n\n\tuseEffect(() => {\n\t\tconsole.log('useEffect');\n\t\tif (lights) {\n\t\t\tfor (const lightConf of lights) {\n\t\t\t\tlightStates[lightConf.name] = false;\n\t\t\t\t// TODO => switch real light to on/off\n\t\t\t}\n\t\t}\n\t}, [lights]);\n\n\tconst switchLight = (lightType: T_LightTypes, on: boolean) => {\n\t\tconst _now = Date.now();\n\t\tif (_now - lastUpdates[lightType] >= config[lightType].waitTime && lightTypeStatus[lightType] !== on) {\n\t\t\tclearTimeout(timeouts[lightType]);\n\t\t\tlastUpdates[lightType] = _now;\n\n\t\t\tlightTypeStatus[lightType] = on;\n\n\t\t\t// TODO => switch real light to on/off\n\t\t\tif (lights) {\n\t\t\t\tfor (const lightConf of lights) {\n\t\t\t\t\tif (lightConf.lightType === lightType) {\n\t\t\t\t\t\tlightStates[lightConf.name] = on;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (config[lightType].timeout !== 0) {\n\t\t\t\ttimeouts[lightType] = setTimeout(() => {\n\t\t\t\t\tlightTypeStatus[lightType] = false;\n\n\t\t\t\t\t// TODO => switch real light to off\n\t\t\t\t\tif (lights) {\n\t\t\t\t\t\tfor (const lightConf of lights) {\n\t\t\t\t\t\t\tif (lightConf.lightType === lightType) {\n\t\t\t\t\t\t\t\tlightStates[lightConf.name] = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, config[lightType].timeout);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst visiualizeTotal = (bufferLength: number, dataArray: Uint8Array) => {\n\t\tconst WIDTH = canvasRefTotal.current.width;\n\t\tconst HEIGHT = canvasRefTotal.current.height;\n\n\t\tif (!running || !analyser) return;\n\n\t\tcanvasCtxTotal.clearRect(0, 0, WIDTH, HEIGHT);\n\n\t\tlet firstTime = true;\n\n\t\tconst draw = () => {\n\t\t\tif (!running || !analyser) return;\n\t\t\tanalyser.getByteFrequencyData(dataArray);\n\t\t\tconst setDrawVisual_ = requestAnimationFrame(draw);\n\t\t\tsetDrawVisualTotal(setDrawVisual_);\n\t\t\tcanvasCtxTotal.fillStyle = 'rgb(51, 51, 51)';\n\t\t\tcanvasCtxTotal.fillRect(0, 0, WIDTH, HEIGHT);\n\t\t\t// const barWidth = (WIDTH / bufferLength) * 2.5;\n\t\t\tconst barWidth = WIDTH / 10;\n\n\t\t\t// total avarage (volumeChanged)\n\t\t\tconst _totalAv =\n\t\t\t\tavarageLightTotalArray.reduce((accumulator, curr) => accumulator + curr, 0) /\n\t\t\t\tavarageLightTotalArray.length;\n\t\t\tconst _last50totalAv = avarageLightTotalArray.slice(avarageLightTotalArray.length < -64 ? -1 : -6);\n\t\t\tconst _last50totalAv_av =\n\t\t\t\t_last50totalAv.reduce((accumulator, curr) => accumulator + curr, 0) / _last50totalAv.length;\n\t\t\tcanvasCtxTotal.fillStyle = 'rgb(' + (_totalAv + 100) + ',200,200)';\n\t\t\tcanvasCtxTotal.fillRect(\n\t\t\t\t((WIDTH + 6) / 5 - barWidth / 2) * 1,\n\t\t\t\tHEIGHT - _totalAv / 2,\n\t\t\t\tbarWidth,\n\t\t\t\t_totalAv / 2,\n\t\t\t);\n\n\t\t\t// volume getting up\n\t\t\tif (_totalAv < _last50totalAv_av) {\n\t\t\t\tswitchLight('volumeChangedLight', true);\n\t\t\t}\n\t\t\t// volume getting down\n\t\t\tif (_totalAv > _last50totalAv_av) {\n\t\t\t\tswitchLight('volumeChangedLight', false);\n\t\t\t}\n\n\t\t\t//avarage * 3 (avarage)\n\t\t\tconst _last500totalAv = avarageLightTotalArray.slice(avarageLightTotalArray.length < -30 ? -1 : -30);\n\t\t\tconst _last500totalAv_av =\n\t\t\t\t_last500totalAv.reduce((accumulator, curr) => accumulator + curr, 0) / _last500totalAv.length;\n\t\t\tconst _avX3 = (dataArray.reduce((accumulator, curr) => accumulator + curr, 0) / bufferLength) * 3;\n\t\t\tcanvasCtxTotal.fillStyle = 'rgb(' + (_avX3 + 100) + ',200,200)';\n\t\t\tcanvasCtxTotal.fillRect(((WIDTH + 6) / 5 - barWidth / 2) * 2, HEIGHT - _avX3 / 2, barWidth, _avX3 / 2);\n\t\t\tif (_avX3 > _last500totalAv_av * config['avarageLight'].threshold) {\n\t\t\t\tswitchLight('avarageLight', true);\n\t\t\t}\n\t\t\tavarageLightTotalArray.push(_avX3);\n\n\t\t\t// max (max)\n\t\t\tconst _max = dataArray.reduce((accumulator, curr) => (accumulator < curr ? curr : accumulator), 0);\n\t\t\tcanvasCtxTotal.fillStyle = 'rgb(' + (_max + 100) + ',200,200)';\n\t\t\tcanvasCtxTotal.fillRect(((WIDTH + 6) / 5 - barWidth / 2) * 3, HEIGHT - _max / 2, barWidth, _max / 2);\n\t\t\tif (_max > _last500totalAv_av * config['maxLight'].threshold) {\n\t\t\t\tswitchLight('maxLight', true);\n\t\t\t}\n\n\t\t\t//avarage without 0 (avarageLong)\n\t\t\tconst _last50Without0Av = avarageLongLightTotalArray.slice(\n\t\t\t\tavarageLongLightTotalArray.length < -100 ? -1 : -100,\n\t\t\t);\n\t\t\tconst _last50Without0Av_av =\n\t\t\t\t_last50Without0Av.reduce((accumulator, curr) => accumulator + curr, 0) / _last50Without0Av.length;\n\t\t\tconst _countAVWithout0 = dataArray.filter((e) => e !== 0).length;\n\t\t\tconst _avWithout0 = dataArray.reduce((accumulator, curr) => accumulator + curr, 0) / _countAVWithout0;\n\t\t\tcanvasCtxTotal.fillStyle = 'rgb(' + (_avWithout0 + 100) + ',200,200)';\n\t\t\tcanvasCtxTotal.fillRect(\n\t\t\t\t((WIDTH + 6) / 5 - barWidth / 2) * 4,\n\t\t\t\tHEIGHT - _avWithout0 / 2,\n\t\t\t\tbarWidth,\n\t\t\t\t_avWithout0 / 2,\n\t\t\t);\n\t\t\tif (_avWithout0 > _last50Without0Av_av * config['avarageLong'].threshold) {\n\t\t\t\tswitchLight('avarageLong', true);\n\t\t\t}\n\t\t\tavarageLongLightTotalArray.push(_avWithout0);\n\n\t\t\tif (firstTime) console.log(dataArray);\n\t\t\tfirstTime = false;\n\t\t};\n\t\tdraw();\n\t};\n\n\tconst visualizeBar = (bufferLength: number, dataArray: Uint8Array) => {\n\t\tconst WIDTH = canvasRefBar.current.width;\n\t\tconst HEIGHT = canvasRefBar.current.height;\n\n\t\tif (!running || !analyser) return;\n\n\t\tconsole.log(bufferLength);\n\n\t\tcanvasCtxBar.clearRect(0, 0, WIDTH, HEIGHT);\n\n\t\t//reference this using self\n\t\tconst draw = () => {\n\t\t\tif (!running || !analyser) return;\n\t\t\tconst setDrawVisual_ = requestAnimationFrame(draw);\n\t\t\tsetDrawVisualBar(setDrawVisual_);\n\t\t\tanalyser.getByteFrequencyData(dataArray);\n\t\t\tcanvasCtxBar.fillStyle = 'rgb(51, 51, 51)';\n\t\t\tcanvasCtxBar.fillRect(0, 0, WIDTH, HEIGHT);\n\t\t\t// const barWidth = (WIDTH / bufferLength) * 2.5;\n\t\t\tconst barWidth = WIDTH / (bufferLength + 0.7);\n\t\t\tlet barHeight;\n\t\t\tlet x = 0;\n\t\t\tfor (let i = 0; i < bufferLength; i++) {\n\t\t\t\tbarHeight = dataArray[i];\n\t\t\t\tcanvasCtxBar.fillStyle = 'rgb(' + (barHeight + 100) + ',50,50)';\n\t\t\t\tcanvasCtxBar.fillRect(x, HEIGHT - barHeight / 2, barWidth, barHeight / 2);\n\t\t\t\tx += barWidth + 1;\n\t\t\t}\n\t\t};\n\n\t\tdraw();\n\t};\n\n\tconst stop = () => {\n\t\tif (canvasCtxBar) {\n\t\t\twindow.cancelAnimationFrame(drawVisualBar);\n\t\t\tconst WIDTH = canvasRefBar.current.width;\n\t\t\tconst HEIGHT = canvasRefBar.current.height;\n\t\t\tcanvasCtxBar.clearRect(0, 0, WIDTH, HEIGHT);\n\t\t}\n\t\tif (canvasCtxTotal) {\n\t\t\twindow.cancelAnimationFrame(drawVisualTotal);\n\t\t\tconst WIDTH1 = canvasRefTotal.current.width;\n\t\t\tconst HEIGHT1 = canvasRefTotal.current.height;\n\t\t\tcanvasCtxTotal.clearRect(0, 0, WIDTH1, HEIGHT1);\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tif (running && analyser) {\n\t\t\tObject.keys(lightStates).forEach((key) => {\n\t\t\t\tlightStates[key] = false;\n\t\t\t});\n\t\t\tconst bufferLength = analyser.frequencyBinCount;\n\t\t\tconst dataArray = new Uint8Array(bufferLength);\n\t\t\tvisualizeBar(bufferLength, dataArray);\n\t\t\tvisiualizeTotal(bufferLength, dataArray);\n\t\t} else {\n\t\t\tstop();\n\t\t}\n\t}, [running]);\n\n\tconst switchLightState = (lightName: string, lightCurrentState: boolean) => {\n\t\tif (running) {\n\t\t\tconsole.log('only if animation is off');\n\t\t\treturn;\n\t\t}\n\n\t\tlightStates[lightName] = !lightCurrentState;\n\t\tconsole.log(lightStates, lightName, !lightCurrentState);\n\t\tforceUpdate();\n\t\t// TODO => switch real light to on/off\n\t};\n\n\treturn (\n\t\t<Box alignSelf=\"center\" pad=\"small\" justify=\"center\" gap=\"medium\">\n\t\t\t<Box direction=\"row\" gap=\"small\" justify=\"center\">\n\t\t\t\t<Box\n\t\t\t\t\tpad=\"xsmall\"\n\t\t\t\t\talignSelf=\"center\"\n\t\t\t\t\tborder={{ color: 'dark-2', size: 'medium' }}\n\t\t\t\t\tround=\"medium\"\n\t\t\t\t\televation=\"small\"\n\t\t\t\t>\n\t\t\t\t\t<Box alignSelf=\"center\">Bar</Box>\n\t\t\t\t\t<canvas width=\"300\" height=\"100\" ref={canvasRefBar}></canvas>\n\t\t\t\t\t<Box direction=\"row\" justify=\"around\" margin=\"small\">\n\t\t\t\t\t\t<Box>\n\t\t\t\t\t\t\t<RadialSelected color=\"brand\" size=\"small\" opacity=\"0\" />\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Box>\n\t\t\t\t</Box>\n\t\t\t\t<Box\n\t\t\t\t\tpad=\"xsmall\"\n\t\t\t\t\talignSelf=\"center\"\n\t\t\t\t\tborder={{ color: 'dark-2', size: 'medium' }}\n\t\t\t\t\tround=\"medium\"\n\t\t\t\t\televation=\"small\"\n\t\t\t\t>\n\t\t\t\t\t<Box alignSelf=\"center\">Total</Box>\n\t\t\t\t\t<canvas width=\"50\" height=\"100\" ref={canvasRefTotal}></canvas>\n\t\t\t\t\t<Box direction=\"row\" justify=\"around\" margin=\"small\">\n\t\t\t\t\t\t{Object.entries(lightTypeStatus).map(([key, value]) => (\n\t\t\t\t\t\t\t<Box key={'lightTypeStatus_' + key}>\n\t\t\t\t\t\t\t\t<RadialSelected color={value ? 'status-warning' : 'status-disabled'} size=\"small\" />\n\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</Box>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t\t{lights && (\n\t\t\t\t<Box pad=\"xsmall\" alignSelf=\"center\">\n\t\t\t\t\t<Box direction=\"row\" justify=\"around\" margin=\"small\">\n\t\t\t\t\t\t{Object.entries(lights).map(([key, value]) => (\n\t\t\t\t\t\t\t<Box key={`lights-${key}`} pad=\"small\" margin=\"small\" align=\"center\" gap=\"small\">\n\t\t\t\t\t\t\t\t<Heading level=\"5\" margin=\"none\">\n\t\t\t\t\t\t\t\t\t{(value as any).name}\n\t\t\t\t\t\t\t\t</Heading>\n\t\t\t\t\t\t\t\t<RadialSelected\n\t\t\t\t\t\t\t\t\tcolor={lightStates[(value as any).name] ? 'status-warning' : 'status-disabled'}\n\t\t\t\t\t\t\t\t\tsize=\"large\"\n\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\tswitchLightState((value as any).name, lightStates[(value as any).name])\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</Box>\n\t\t\t\t</Box>\n\t\t\t)}\n\t\t</Box>\n\t);\n};\n\nexport default VisualController;\n","import { Box, Button } from 'grommet';\nimport React, { FC, useEffect, useState } from 'react';\nimport VisualController from './VisualController';\n\nconst Controller: FC<any> = () => {\n\tconst [audioCtx, setAudioCtx] = useState<AudioContext | null>(null);\n\tconst [audioInput, setAudioInput] = useState<MediaStreamAudioSourceNode | null>(null);\n\tconst [analyser, setAnalyser] = useState<AnalyserNode | null>(null);\n\tconst [running, setRunning] = useState<boolean>(false);\n\tconst [stream, setStream] = useState<MediaStream | null>(null);\n\n\tuseEffect(() => {\n\t\t// Some browsers partially implement mediaDevices. We can't just assign an object\n\t\t// with getUserMedia as it would overwrite existing properties.\n\t\t// Here, we will just add the getUserMedia property if it's missing.\n\t\tif (navigator.mediaDevices.getUserMedia === undefined) {\n\t\t\tnavigator.mediaDevices.getUserMedia = function (constraints) {\n\t\t\t\t// First get ahold of the legacy getUserMedia, if present\n\t\t\t\tconst getUserMedia =\n\t\t\t\t\t(navigator as any).webkitGetUserMedia ||\n\t\t\t\t\t(navigator as any).mozGetUserMedia ||\n\t\t\t\t\t(navigator as any).msGetUserMedia;\n\n\t\t\t\t// Some browsers just don't implement it - return a rejected promise with an error\n\t\t\t\t// to keep a consistent interface\n\t\t\t\tif (!getUserMedia) {\n\t\t\t\t\treturn Promise.reject(new Error('getUserMedia is not implemented in this browser'));\n\t\t\t\t}\n\n\t\t\t\t// Otherwise, wrap the call to the old navigator.getUserMedia with a Promise\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tgetUserMedia.call(navigator, constraints, resolve, reject);\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\t// (navigator as any).getUserMedia =\n\t\t// \t(navigator as any).getUserMedia ||\n\t\t// \t(navigator as any).webkitGetUserMedia ||\n\t\t// \t(navigator as any).mozGetUserMedia;\n\n\t\tconst _audioCtx: AudioContext = new window.AudioContext() || (window as any).webkitAudioContext;\n\t\tsetAudioCtx(_audioCtx);\n\t}, []);\n\n\tconst setupMic = async () => {\n\t\tif (audioCtx === null) return;\n\t\ttry {\n\t\t\tconst analyser_ = audioCtx.createAnalyser();\n\t\t\tanalyser_.minDecibels = -90;\n\t\t\tanalyser_.maxDecibels = -10;\n\t\t\tanalyser_.smoothingTimeConstant = 0.85;\n\t\t\t// analyser_.fftSize = 256;\n\t\t\tanalyser_.fftSize = 64;\n\t\t\tsetAnalyser(analyser_);\n\n\t\t\tconst distortion = audioCtx.createWaveShaper();\n\t\t\tconst gainNode = audioCtx.createGain();\n\t\t\tconst biquadFilter = audioCtx.createBiquadFilter();\n\t\t\tconst convolver = audioCtx.createConvolver();\n\n\t\t\tlet stream_: MediaStream;\n\t\t\t(window as any).stream = stream_ = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });\n\t\t\tconst audioInput_ = audioCtx.createMediaStreamSource(stream_);\n\t\t\tsetStream(stream_);\n\n\t\t\taudioInput_.connect(distortion);\n\t\t\tdistortion.connect(biquadFilter);\n\t\t\tbiquadFilter.connect(gainNode);\n\t\t\tconvolver.connect(gainNode);\n\t\t\tgainNode.connect(analyser_);\n\n\t\t\tsetAudioInput(audioInput_);\n\n\t\t\t// distortion.oversample = '2x';\n\t\t\tbiquadFilter.gain.setTargetAtTime(0, audioCtx.currentTime, 0);\n\t\t\tbiquadFilter.disconnect(0);\n\t\t\tbiquadFilter.connect(gainNode);\n\n\t\t\tbiquadFilter.type = 'lowshelf';\n\t\t\tbiquadFilter.frequency.setTargetAtTime(1000, audioCtx.currentTime, 0);\n\t\t\t// biquadFilter.gain.setTargetAtTime(25, audioCtx.currentTime, 0);\n\n\t\t\tsetRunning(true);\n\t\t} catch (err) {\n\t\t\t//TODO: error getting stream\n\t\t\tconsole.log('Error: Issue getting mic', err);\n\t\t}\n\t};\n\n\tconst start = async () => {\n\t\tawait setupMic();\n\t};\n\n\tconst closeMic = () => {\n\t\tsetRunning(false);\n\t\tif (analyser) {\n\t\t\tanalyser.disconnect(0);\n\t\t\tsetAnalyser(null);\n\t\t}\n\t\tif (audioInput) {\n\t\t\taudioInput.disconnect(0);\n\t\t\tsetAudioInput(null);\n\t\t}\n\t\tif (stream) {\n\t\t\tstream.getAudioTracks().forEach((track: any) => {\n\t\t\t\ttrack.stop();\n\t\t\t});\n\t\t\tsetStream(null);\n\t\t}\n\t};\n\n\tconst stop = () => {\n\t\tcloseMic();\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<Box direction=\"row\" justify=\"center\" gap=\"medium\" margin=\"small\">\n\t\t\t\t{!running ? <Button onClick={start} label=\"Start\" /> : <Button onClick={stop} label=\"Stop\" />}\n\t\t\t</Box>\n\n\t\t\t<VisualController running={running} analyser={analyser} />\n\t\t</>\n\t);\n};\n\nexport default Controller;\n","import React, { FC, useEffect, useState } from 'react';\nimport { Box, Button, Heading, Select, TextInput } from 'grommet';\nimport { db, L_LightTypes_List, L_ShellyTypes_List, T_Light, T_LightTypes, T_ShellyTypes } from '../db';\nimport { Add, Save } from 'grommet-icons';\n\nexport interface I_NewEditLight_Props {\n\tmethod: 'new' | 'edit';\n\ttoEditLight?: T_Light;\n\tonClose: any;\n}\n\nconst NewEditLight: FC<I_NewEditLight_Props> = ({ method, toEditLight, onClose }: I_NewEditLight_Props) => {\n\tconst [lightName, setLightName] = useState<string>('');\n\tconst [lightIP, setLightIP] = useState<string>('');\n\tconst [shellyType, setShellyType] = useState<T_ShellyTypes | null>(null);\n\tconst [lightType, setlightType] = useState<T_LightTypes | null>(null);\n\tconst [title, setTitle] = useState<string>('Add new Light');\n\n\tuseEffect(() => {\n\t\tif (method === 'edit' && toEditLight) {\n\t\t\tsetLightName(toEditLight.name);\n\t\t\tsetLightIP(toEditLight.ip);\n\t\t\tsetShellyType(toEditLight.shellyType);\n\t\t\tsetlightType(toEditLight.lightType);\n\t\t\tsetTitle('Edit Light');\n\t\t}\n\t}, []);\n\n\tconst saveAdd = async () => {\n\t\tif (lightName !== '' && lightIP !== '' && shellyType !== null && lightType !== null) {\n\t\t\tif (method === 'new') {\n\t\t\t\ttry {\n\t\t\t\t\t// add to db\n\t\t\t\t\tconst id = await db.lights.add({\n\t\t\t\t\t\tname: lightName,\n\t\t\t\t\t\tlightType: lightType,\n\t\t\t\t\t\tshellyType: shellyType,\n\t\t\t\t\t\tip: lightIP,\n\t\t\t\t\t});\n\t\t\t\t\tconsole.log('ID = ' + id);\n\t\t\t\t\t// reset\n\t\t\t\t\tsetLightName('');\n\t\t\t\t\tsetLightIP('');\n\t\t\t\t\tsetShellyType(null);\n\t\t\t\t\tsetlightType(null);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log(`Failed to add ${name}: ${error}`);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (toEditLight && toEditLight.id)\n\t\t\t\t\tdb.lights.put(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: toEditLight.id,\n\t\t\t\t\t\t\tname: lightName,\n\t\t\t\t\t\t\tlightType: lightType,\n\t\t\t\t\t\t\tshellyType: shellyType,\n\t\t\t\t\t\t\tip: lightIP,\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttoEditLight.id,\n\t\t\t\t\t);\n\t\t\t\tonClose();\n\t\t\t}\n\t\t} else {\n\t\t\talert('Everything is mandatory');\n\t\t}\n\t};\n\n\treturn (\n\t\t<Box border={{ color: 'dark-3', size: 'small' }} round=\"xsmall\">\n\t\t\t<Heading level=\"3\" margin=\"xsmall\" alignSelf=\"center\">\n\t\t\t\t{title}\n\t\t\t</Heading>\n\t\t\t<Box border={[{ color: 'dark-3', size: 'small', side: 'bottom' }]} />\n\t\t\t<Box margin=\"medium\" direction=\"row\" gap=\"small\" align=\"center\" wrap>\n\t\t\t\t<Box>\n\t\t\t\t\t<TextInput\n\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\tplaceholder=\"Light Name...\"\n\t\t\t\t\t\tvalue={lightName}\n\t\t\t\t\t\tplain\n\t\t\t\t\t\tonChange={(event) => setLightName(event.target.value)}\n\t\t\t\t\t/>\n\t\t\t\t</Box>\n\t\t\t\t<Box>\n\t\t\t\t\t<TextInput\n\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\tplaceholder=\"Light IP...\"\n\t\t\t\t\t\tvalue={lightIP}\n\t\t\t\t\t\tplain\n\t\t\t\t\t\tonChange={(event) => setLightIP(event.target.value)}\n\t\t\t\t\t/>\n\t\t\t\t</Box>\n\t\t\t\t<Select\n\t\t\t\t\tsize=\"small\"\n\t\t\t\t\tplaceholder=\"select Shelly Type...\"\n\t\t\t\t\tvalue={shellyType ?? ''}\n\t\t\t\t\toptions={L_ShellyTypes_List}\n\t\t\t\t\tonChange={({ option }) => setShellyType(option)}\n\t\t\t\t/>\n\t\t\t\t<Select\n\t\t\t\t\tsize=\"small\"\n\t\t\t\t\tplaceholder=\"select Light Type...\"\n\t\t\t\t\tvalue={lightType ?? ''}\n\t\t\t\t\toptions={L_LightTypes_List}\n\t\t\t\t\tonChange={({ option }) => setlightType(option)}\n\t\t\t\t/>\n\n\t\t\t\t<Box round=\"full\" overflow=\"hidden\" background=\"status-ok\" alignSelf=\"center\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\ticon={method === 'new' ? <Add size=\"small\" /> : <Save size=\"small\" />}\n\t\t\t\t\t\tonClick={() => saveAdd()}\n\t\t\t\t\t\thoverIndicator\n\t\t\t\t\t/>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</Box>\n\t);\n};\n\nexport default NewEditLight;\n","import React, { FC } from 'react';\nimport { Box, TextInput } from 'grommet';\nimport { T_Light } from '../db';\nimport { Edit, Trash } from 'grommet-icons';\n\nexport interface I_LigthListElement_Props {\n\tlight: T_Light;\n\tonEditLight: any;\n\tonRemoveLight: any;\n}\n\nconst LigthListElement: FC<I_LigthListElement_Props> = ({\n\tlight,\n\tonEditLight,\n\tonRemoveLight,\n}: I_LigthListElement_Props) => {\n\treturn (\n\t\t<Box margin=\"medium\" direction=\"row\" gap=\"small\" justify=\"around\" align=\"center\">\n\t\t\t<Box>\n\t\t\t\t<TextInput size=\"small\" value={light.name} plain />\n\t\t\t</Box>\n\t\t\t<Box>\n\t\t\t\t<TextInput size=\"small\" value={light.ip} plain />\n\t\t\t</Box>\n\t\t\t<Box direction=\"row\" gap=\"small\" margin={{ right: 'small' }}>\n\t\t\t\t<Edit color=\"status-warning\" size=\"medium\" onClick={() => onEditLight(light)} />\n\t\t\t\t<Trash color=\"status-error\" size=\"medium\" onClick={() => onRemoveLight(light)} />\n\t\t\t</Box>\n\t\t</Box>\n\t);\n};\n\nexport default LigthListElement;\n","import React, { FC } from 'react';\nimport { Box, Heading } from 'grommet';\nimport LigthListElement from './LightListElement';\nimport { T_Light } from '../db';\n\nexport interface I_LightList_Props {\n\tlights: T_Light[];\n\tonEditLight: any;\n\tonRemoveLight: any;\n}\n\nconst LightList: FC<I_LightList_Props> = ({ lights, onEditLight, onRemoveLight }: I_LightList_Props) => {\n\treturn (\n\t\t<Box border={{ color: 'dark-3', size: 'small' }} round=\"xsmall\">\n\t\t\t<Heading level=\"3\" margin=\"xsmall\" alignSelf=\"center\">\n\t\t\t\tExisting Lights\n\t\t\t</Heading>\n\t\t\t<Box border={[{ color: 'dark-3', size: 'small', side: 'bottom' }]} />\n\t\t\t{lights.map((light) => (\n\t\t\t\t<LigthListElement\n\t\t\t\t\tkey={`hallo_${light.name}`}\n\t\t\t\t\tlight={light}\n\t\t\t\t\tonEditLight={onEditLight}\n\t\t\t\t\tonRemoveLight={onRemoveLight}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</Box>\n\t);\n};\n\nexport default LightList;\n","import React, { FC, useState } from 'react';\nimport { Box, Button, Header, Heading, Main } from 'grommet';\nimport { db, T_Light } from '../db';\nimport NewEditLight from './NewEditLight';\nimport LightList from './LightList';\nimport { useLiveQuery } from 'dexie-react-hooks';\n\nexport interface I_Configuration_Props {\n\tsetClose: any;\n}\n\nconst Configuration: FC<I_Configuration_Props> = ({ setClose }: I_Configuration_Props) => {\n\tconst [isEdit, setIsEdit] = useState<boolean>(false);\n\tconst [selectedLight, setSelectedLight] = useState<T_Light | null>(null);\n\tconst lights = useLiveQuery(() => db.lights.toArray());\n\n\tconst onClose = () => {\n\t\tsetIsEdit(false);\n\t};\n\n\tconst onEditLight = (light: T_Light) => {\n\t\tsetIsEdit(true);\n\t\tsetSelectedLight(light);\n\t};\n\n\tconst onRemoveLight = (light: T_Light) => {\n\t\tconsole.log(light);\n\t\tif (light.id) db.lights.delete(light.id);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<Box\n\t\t\t\tjustify=\"center\"\n\t\t\t\talignSelf=\"center\"\n\t\t\t\tmargin=\"small\"\n\t\t\t\tborder={{ color: 'dark-3', size: 'small' }}\n\t\t\t\tround=\"medium\"\n\t\t\t\tbackground=\"dark-1\"\n\t\t\t>\n\t\t\t\t<Header\n\t\t\t\t\tjustify=\"between\"\n\t\t\t\t\tmargin={{ horizontal: 'small' }}\n\t\t\t\t\theight=\"xxsmall\"\n\t\t\t\t\tround={{ corner: 'top', size: 'medium' }}\n\t\t\t\t>\n\t\t\t\t\t<Heading level=\"2\" margin=\"none\">\n\t\t\t\t\t\tConfig\n\t\t\t\t\t</Heading>\n\t\t\t\t\t<Box>\n\t\t\t\t\t\t<Button size=\"small\" label=\"Close\" onClick={() => setClose()} />\n\t\t\t\t\t</Box>\n\t\t\t\t</Header>\n\t\t\t\t<Box border={[{ color: 'dark-3', size: 'small', side: 'bottom' }]} />\n\t\t\t\t<Main alignSelf=\"center\">\n\t\t\t\t\t{!isEdit && (\n\t\t\t\t\t\t<Box pad=\"small\" justify=\"center\" gap=\"large\">\n\t\t\t\t\t\t\t<NewEditLight method=\"new\" onClose={onClose} />\n\t\t\t\t\t\t\t{lights && (\n\t\t\t\t\t\t\t\t<LightList lights={lights} onEditLight={onEditLight} onRemoveLight={onRemoveLight} />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t)}\n\t\t\t\t\t{isEdit && selectedLight && (\n\t\t\t\t\t\t<Box pad=\"small\" justify=\"center\" gap=\"large\">\n\t\t\t\t\t\t\t<NewEditLight method=\"edit\" toEditLight={selectedLight} onClose={onClose} />\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t)}\n\t\t\t\t</Main>\n\t\t\t</Box>\n\t\t\t<button\n\t\t\t\tclassName=\"large-button\"\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdb.transaction('rw', db.tables, async () => {\n\t\t\t\t\t\tawait Promise.all(db.tables.map((table) => table.clear()));\n\t\t\t\t\t});\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\tClear Database\n\t\t\t</button>\n\t\t</>\n\t);\n};\n\nexport default Configuration;\n","import { Box, Button, grommet, Grommet, Header, Heading, Layer, Main } from 'grommet';\nimport React, { useState } from 'react';\nimport './App.css';\nimport Controller from './controllers/controller';\nimport Configuration from './configuration/config';\n\nconst App = (): JSX.Element => {\n\tconst [showConfig, setShowConfig] = useState<boolean>(false);\n\n\treturn (\n\t\t<>\n\t\t\t<Grommet theme={grommet} background=\"dark-1\">\n\t\t\t\t{!showConfig && (\n\t\t\t\t\t<Box\n\t\t\t\t\t\tjustify=\"center\"\n\t\t\t\t\t\talignSelf=\"center\"\n\t\t\t\t\t\tmargin=\"small\"\n\t\t\t\t\t\tborder={{ color: 'dark-3', size: 'small' }}\n\t\t\t\t\t\tround=\"medium\"\n\t\t\t\t\t\tbackground=\"dark-1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Header\n\t\t\t\t\t\t\theight=\"xxsmall\"\n\t\t\t\t\t\t\tround={{ corner: 'top', size: 'large' }}\n\t\t\t\t\t\t\tjustify=\"between\"\n\t\t\t\t\t\t\tmargin={{ horizontal: 'small' }}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Heading level=\"3\" margin=\"none\">\n\t\t\t\t\t\t\t\tLightshow with Shellys V0.0.13\n\t\t\t\t\t\t\t</Heading>\n\t\t\t\t\t\t\t<Box>\n\t\t\t\t\t\t\t\t<Button size=\"small\" label=\"Settings\" onClick={() => setShowConfig(true)} />\n\t\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t</Header>\n\t\t\t\t\t\t<Box border={[{ color: 'dark-3', size: 'small', side: 'bottom' }]} />\n\t\t\t\t\t\t<Main alignSelf=\"center\" pad=\"small\" justify=\"center\">\n\t\t\t\t\t\t\t<Controller />\n\t\t\t\t\t\t</Main>\n\t\t\t\t\t</Box>\n\t\t\t\t)}\n\t\t\t\t{showConfig && (\n\t\t\t\t\t<Configuration\n\t\t\t\t\t\tsetClose={() => {\n\t\t\t\t\t\t\tsetShowConfig(false);\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</Grommet>\n\t\t</>\n\t);\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\n/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\n\nconst isLocalhost = Boolean(\n\twindow.location.hostname === 'localhost' ||\n\t\t// [::1] is the IPv6 localhost address.\n\t\twindow.location.hostname === '[::1]' ||\n\t\t// 127.0.0.0/8 are considered localhost for IPv4.\n\t\twindow.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/),\n);\n\ntype Config = {\n\tonSuccess?: (registration: ServiceWorkerRegistration) => void;\n\tonUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n\tif (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n\t\t// The URL constructor is available in all browsers that support SW.\n\t\tconst publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n\t\tif (publicUrl.origin !== window.location.origin) {\n\t\t\t// Our service worker won't work if PUBLIC_URL is on a different origin\n\t\t\t// from what our page is served on. This might happen if a CDN is used to\n\t\t\t// serve assets; see https://github.com/facebook/create-react-app/issues/2374\n\t\t\treturn;\n\t\t}\n\n\t\twindow.addEventListener('load', () => {\n\t\t\tconst swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n\t\t\tif (isLocalhost) {\n\t\t\t\t// This is running on localhost. Let's check if a service worker still exists or not.\n\t\t\t\tcheckValidServiceWorker(swUrl, config);\n\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the\n\t\t\t\t// service worker/PWA documentation.\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t'This web app is being served cache-first by a service ' +\n\t\t\t\t\t\t\t'worker. To learn more, visit https://cra.link/PWA',\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Is not localhost. Just register service worker\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n\tnavigator.serviceWorker\n\t\t.register(swUrl)\n\t\t.then((registration) => {\n\t\t\tregistration.onupdatefound = () => {\n\t\t\t\tconst installingWorker = registration.installing;\n\t\t\t\tif (installingWorker == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tinstallingWorker.onstatechange = () => {\n\t\t\t\t\tif (installingWorker.state === 'installed') {\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\n\t\t\t\t\t\t\t// At this point, the updated precached content has been fetched,\n\t\t\t\t\t\t\t// but the previous service worker will still serve the older\n\t\t\t\t\t\t\t// content until all client tabs are closed.\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t'New content is available and will be used when all ' +\n\t\t\t\t\t\t\t\t\t'tabs for this page are closed. See https://cra.link/PWA.',\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && config.onUpdate) {\n\t\t\t\t\t\t\t\tconfig.onUpdate(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// At this point, everything has been precached.\n\t\t\t\t\t\t\t// It's the perfect time to display a\n\t\t\t\t\t\t\t// \"Content is cached for offline use.\" message.\n\t\t\t\t\t\t\tconsole.log('Content is cached for offline use.');\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && config.onSuccess) {\n\t\t\t\t\t\t\t\tconfig.onSuccess(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t})\n\t\t.catch((error) => {\n\t\t\tconsole.error('Error during service worker registration:', error);\n\t\t});\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n\t// Check if the service worker can be found. If it can't reload the page.\n\tfetch(swUrl, {\n\t\theaders: { 'Service-Worker': 'script' },\n\t})\n\t\t.then((response) => {\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\n\t\t\tconst contentType = response.headers.get('content-type');\n\t\t\tif (response.status === 404 || (contentType != null && contentType.indexOf('javascript') === -1)) {\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\n\t\t\t\tnavigator.serviceWorker.ready.then((registration) => {\n\t\t\t\t\tregistration.unregister().then(() => {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Service worker found. Proceed as normal.\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t})\n\t\t.catch(() => {\n\t\t\tconsole.log('No internet connection found. App is running in offline mode.');\n\t\t});\n}\n\nexport function unregister() {\n\tif ('serviceWorker' in navigator) {\n\t\tnavigator.serviceWorker.ready\n\t\t\t.then((registration) => {\n\t\t\t\tregistration.unregister();\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error(error.message);\n\t\t\t});\n\t}\n}\n","/* eslint-disable @typescript-eslint/explicit-function-return-type */\n/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\nimport { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n\tif (onPerfEntry && onPerfEntry instanceof Function) {\n\t\timport('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n\t\t\tgetCLS(onPerfEntry);\n\t\t\tgetFID(onPerfEntry);\n\t\t\tgetFCP(onPerfEntry);\n\t\t\tgetLCP(onPerfEntry);\n\t\t\tgetTTFB(onPerfEntry);\n\t\t});\n\t}\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById('root'),\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://cra.link/PWA\nserviceWorkerRegistration.register();\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}